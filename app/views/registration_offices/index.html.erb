<h1 class="page-header-text text-shadow">Registration Offices in Berlin</h1>

<div class="container info-registration-offices">
  <div class="info-paragraph">
    <h3>What do I need to do with a <i>"Registration Office"</i> ?</h3>
    <p>The <i>Anmeldung</i> Lorem ipsum dolor, sit amet consectetur adipisicing elit. Dignissimos earum animi dolore quam.
    Maxime earum, eius, quae ad voluptatibus minima quisquam incidunt dolor quos repellat aut, quam ea mollitia rem?

    Lorem ipsum dolor sit amet consectetur adipisicing elit. Amet dignissimos corrupti quaerat, sunt velit sit perspiciatis
    itaque! Veniam ex commodi quo excepturi ut quidem cum sequi illum neque. Commodi, explicabo!
    <br>
    <br>
    Please choose a registration office from the list below and book a free appointment ...</p>
  </div>
</div>

<div class="container registration-offices-cards important-margin-class">
  <% if current_user.appointments.any? %>
    <div class="booked-appointment">
      <p>You've already booked an appointment.</p> <br>
      <%= link_to 'See your appointment', appointment_path(current_user.appointments.first), class: 'btn btn-flat-even' %>
    </div>
  <% else %>
    <% @registration_offices.each_with_index do |registration_office, index| %>

      <button type="button" class="card-registration-office" data-toggle="modal" data-target="#exampleModal<%= index %>">
        <%= registration_office.office_name %>
      </button>

      <div class="modal fade" id="exampleModal<%= index %>" tabindex="-1" role="dialog" aria-labelledby="<%= index %>" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="example"> Please choose a free appointment with <%= registration_office.office_name %> and confirm with "Book"</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body text-center">
              <% counter = 0 %>
              <% registration_office.appointments.each do |appointment| %>
                <% if appointment.not_booked? %>
                  <%= simple_form_for appointment do |f| %>
                    <input class="radio-button" type="radio" id="appointment-<%= counter.to_s %>">
                    <label for="appointment-<%= counter.to_s %>" class="radio-button-label"><%= appointment.date.strftime('%A, %d %b, %l:%M %p') %></label>
                    <% counter += 1 %>
                    <%= f.submit 'Book', class: 'btn-gradient-yellow' %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>

<div class="container">
  <div class="map-container">
    <div id="map"
      data-markers="<%= @markers.to_json %>"
      data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>
</div>

<div class="back-btn-container">
  <%= link_to "<< Back to My Tasks", req_index_path, class: "btn-back" %>
</div>




<%# <div class="modal-footer">
  <button type="button" class="btn btn-flat" data-dismiss="modal">Close</button>
  <%= link_to(req_index_path) do %>
    <%# <button type="button" class="btn btn-gradient-yellow">Book</button> %>
  <%# <% end %>
<%# </div> %>
